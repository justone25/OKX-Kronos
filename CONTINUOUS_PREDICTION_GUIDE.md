# Kronos 持续预测系统使用指南

## 🎯 系统概述

Kronos持续预测系统是一个自动化的加密货币价格预测平台，能够：
- 🔄 定时获取最新市场数据
- 🤖 使用Kronos AI模型进行价格预测
- 💾 自动保存预测结果和历史数据
- 📊 提供实时监控和准确性分析
- 📈 生成可视化图表和报告

## 🚀 快速开始

### 1. 安装依赖
```bash
# 激活虚拟环境
source .venv/bin/activate

# 安装新增依赖
pip install schedule
```

### 2. 启动持续预测
```bash
# 使用默认配置启动（每30分钟预测一次）
python continuous_prediction.py

# 自定义配置启动
python continuous_prediction.py --interval 15 --lookback 24 --pred-hours 3
```

### 3. 查看系统状态
```bash
# 查看当前系统状态和准确性指标
python continuous_prediction.py --mode status
```

## 📋 命令行参数

### 系统配置参数
- `--interval`: 预测间隔（分钟），默认30分钟
- `--lookback`: 历史数据回看时长（小时），默认12小时
- `--pred-hours`: 预测时长（小时），默认6小时
- `--device`: 计算设备（cpu/cuda），默认cpu
- `--db-path`: 数据库文件路径，默认./data/predictions.db

### 运行模式
- `--mode run`: 持续运行模式（默认）
- `--mode status`: 显示系统状态
- `--mode trends`: 显示预测趋势图
- `--mode export`: 导出历史数据

### 其他参数
- `--hours`: 查看或导出的时间范围（小时），默认24小时
- `--output`: 导出文件路径（用于export模式）

## 💡 使用示例

### 启动持续预测（推荐配置）
```bash
# 每15分钟预测一次，回看24小时数据，预测未来3小时
python continuous_prediction.py --interval 15 --lookback 24 --pred-hours 3
```

### 查看系统状态
```bash
python continuous_prediction.py --mode status
```

### 查看预测趋势
```bash
# 查看最近24小时的预测趋势
python continuous_prediction.py --mode trends --hours 24

# 查看最近一周的预测趋势
python continuous_prediction.py --mode trends --hours 168
```

### 导出数据
```bash
# 导出最近24小时的数据为CSV
python continuous_prediction.py --mode export --output ./exports/predictions_24h.csv --hours 24

# 导出最近一周的数据为Excel
python continuous_prediction.py --mode export --output ./exports/predictions_week.xlsx --hours 168
```

## 📊 系统输出

### 持续运行时的输出示例
```
==================================================
🔮 Kronos预测更新 - 2025-08-25 12:00:00
==================================================
💰 当前价格: $113,450.20
🔮 预测价格: $113,580.15
📈 价格变化: +0.11%
📊 趋势方向: UP
⏰ 下次更新: 12:15:00
==================================================
```

### 状态报告示例
```
============================================================
📊 KRONOS 预测系统状态报告
============================================================
🔄 系统状态: 🟢 运行中
📈 总预测次数: 48
⏰ 最近24小时预测: 48
🕐 最后预测时间: 2025-08-25 12:00:00

📊 预测准确性 (最近24小时):
   样本数量: 24
   方向准确率: 75.0%
   平均绝对误差: $125.50
   平均绝对百分比误差: 0.11%

📝 最近系统日志:
   [12:00:15] INFO: 预测周期完成 - 当前价格: $113,450.20, 预测价格: $113,580.15
   [11:45:12] INFO: 预测周期完成 - 当前价格: $113,380.50, 预测价格: $113,420.80
   [11:30:08] INFO: 预测周期完成 - 当前价格: $113,320.10, 预测价格: $113,380.25
============================================================
```

## 🗄️ 数据存储

系统会自动创建SQLite数据库来存储：

### 预测结果表 (predictions)
- 预测时间戳
- 当前价格和预测价格
- 价格变化百分比
- 趋势方向和波动率
- 模型参数

### 实际价格表 (actual_prices)
- 实际市场价格数据
- 用于计算预测准确性

### 系统日志表 (system_logs)
- 系统运行日志
- 错误和异常记录

## 📈 监控和分析

### 预测准确性指标
- **方向准确率**: 预测价格上涨/下跌方向的准确性
- **平均绝对误差(MAE)**: 预测价格与实际价格的平均差值
- **平均绝对百分比误差(MAPE)**: 相对误差百分比
- **均方根误差(RMSE)**: 预测误差的标准差

### 可视化图表
- 价格趋势对比图
- 预测变化率柱状图
- 准确性分析图表

## ⚙️ 高级配置

### 自定义预测参数
可以修改 `src/scheduler/prediction_scheduler.py` 中的参数：
```python
self.temperature = 1.0        # 采样温度
self.top_p = 0.9             # nucleus采样参数
self.sample_count = 1        # 采样次数
```

### 数据库配置
默认使用SQLite，可以修改为其他数据库：
```python
# 在 prediction_scheduler.py 中修改数据库连接
```

## 🔧 故障排除

### 常见问题

1. **模型加载失败**
   - 检查模型文件是否完整下载
   - 确认虚拟环境已激活
   - 检查依赖是否正确安装

2. **API连接失败**
   - 检查网络连接
   - 验证OKX API配置
   - 检查API限制和权限

3. **数据库错误**
   - 检查磁盘空间
   - 确认数据库文件权限
   - 删除损坏的数据库文件重新创建

### 日志文件
系统日志保存在 `./logs/continuous_YYYYMMDD.log`

## 🛑 停止系统

### 优雅停止
- 在终端中按 `Ctrl+C`
- 系统会自动保存当前状态并安全退出

### 强制停止
```bash
# 查找进程ID
ps aux | grep continuous_prediction

# 强制终止
kill -9 <PID>
```

## 📝 最佳实践

1. **推荐配置**：
   - 预测间隔：15-30分钟
   - 回看时长：12-24小时
   - 预测时长：3-6小时

2. **监控建议**：
   - 定期检查系统状态
   - 关注预测准确性变化
   - 及时处理异常日志

3. **数据管理**：
   - 定期备份数据库
   - 清理过期日志文件
   - 导出重要预测数据

## 🚀 扩展功能

系统支持进一步扩展：
- 多交易对预测
- 自定义预测策略
- 邮件/短信通知
- Web界面监控
- 交易信号生成
